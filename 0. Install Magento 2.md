## Install Magento 2
## Development Setup

### 1. [Install PHP7 with FPM](3)
**Install PHP modules**
```
 sudo apt-get install libapache2-mod-php php-mysql php-mcrypt php-curl php-gd libcurl3 php-intl php-xsl php-zip php-mbstring  php-dom php-simplexml php-xml
```

### 2. [Install MySQL 5.6+](4)

### 3. Clone source code

- Use [Git](6)
- For development use `develop` branch

### 4. Install dependencies:

- Install [Composer](1) if not already
- Configure Magento repo auth

```
composer config --global --auth http-basic.repo.magento.com MAGENTO_COMPOSER_USER MAGENTO_COMPOSER_PASS
```

- Run 

```
composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition
```

### 5. Setup permission (require `setfacl`)

```
HTTPDUSER=`ps axo user,comm | grep -E '[a]pache|[h]ttpd|[_]www|[w]ww-data|[n]ginx' | grep -v root | head -1 | cut -d\  -f1` &&
sudo setfacl -R -m u:"$HTTPDUSER":rwX -m u:`whoami`:rwX var pub/static pub/media app/etc generated &&
sudo setfacl -dR -m u:"$HTTPDUSER":rwX -m u:`whoami`:rwX var pub/static pub/media app/etc generated &&
chmod u+x bin/magento
```

### 6. Install and configure Magento

```
php bin/magento setup:install --admin-firstname=Kien --admin-lastname=Pham --admin-email='email@example.com' --admin-user=admin --admin-password='admin123' --base-url='https://m2fresh.local' --backend-frontname=admin --db-host='homestead' --db-name='m2fresh' --db-user='secret' --db-password='123' --language=en_US --currency=USD --timezone='America/Chicago' --admin-use-security-key=0 --session-save=files
php bin/magento deploy:mode:set developer
```

### 7. Setup Nginx

- [Install Nginx](2)
- Create Magento 2 configuration file for Nginx

```
sudo cp nginx.conf.sample /etc/nginx/conf.d/magento2.conf
```

- Update `/etc/nginx/nginx.conf` to add `fastcgi_backend` upstream pointing to PHP FPM socket

```
upstream fastcgi_backend {
    ## Use TCP connection
    # server 127.0.0.1:9000;
    ## Or socket
    server unix:/run/php-fpm/php-fpm.sock;
}
```

### 8. Update host file if needed

`/etc/hosts`

```
127.0.0.1 magento2.local
```

### 9. Check <http://magento2.local>

### 10. (Optional) Setup Redis

- Install [Redis](5)

[1]: <http://getcomposer.org/>
[2]: <http://nginx.org/en/docs/install.html>
[3]: <http://php.net/manual/en/install.php>
[4]: <http://dev.mysql.com/doc/refman/5.7/en/installing.html>
[5]: <http://redis.io/download>
[6]: <https://git-scm.com/>

### 11. Deploy language
```
php bin/magento i18n:pack -m replace vi_VN.csv vi_VN
php bin/magento setup:static-content:deploy vi_VN
php bin/magento cache:clean
php bin/magento cache:flush
```
### 12. Auto fix convention bug
```
php vendor/bin/static-review.php hook:install dev/tools/Magento/Tools/StaticReview/pre-commit .git/hooks/pre-commit
```
